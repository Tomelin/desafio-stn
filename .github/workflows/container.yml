name: container-image
run-name: Container Image CI

on:
  push:
    branches: [ "main", "develop"]
  pull_request:
    branches: [ "main", "develop"]

env:
  production: "docker.io"
  develop: "docker.io"
  registry_username: ${{ secrets.REGISTRY_USERNAME }}
  registry_password: ${{ secrets.REGISTRY_PASSWORD }}
  registry_host: ${{ secrets.REGISTRY_HOST }}
  

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: Docker Auth
      id: docker-auth
      uses: 'docker/login-action@v1'
      with:
        username: ${{ env.registry_username }}
        password: ${{ env.registry_password }}
        registry: ${{ env.registry_host }}

    - name: Build the Docker image
      run: |
        docker build --tag " ${{ env.registry_host }}/tomelin/desafio-stn:0.1.0" -f ./src/build/Dockerfile .
      working-directory: ./
    - name: List images
      run: |
        docker images
      working-directory: ./
    # - name: GITHUB_HEAD_REF
    #   run: echo "${GITHUB_HEAD_REF}"
    # - name: GITHUB_REF_NAME
    #   run: echo "${GITHUB_REF_NAME}"
    # - name: ref_name
    #   if:  github.ref_name == 'main'
    #   run: echo  ${{ github.ref_name }}
     